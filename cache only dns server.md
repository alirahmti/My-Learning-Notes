# 🧠 راه‌اندازی سرور DNS کشی (Cache-Only) با BIND روی Ubuntu 22.04

این راهنما بهت یاد می‌ده چطور یه سرور DNS داخلی راه بندازی که فقط کش کنه و خودش هیچ دامنه‌ای رو مدیریت نکنه.

---

## ✅ Cache-Only DNS Server چیه؟

🟢 یه سروریه که فقط کارش اینه:
- درخواست‌های DNS کلاینت‌ها رو بگیره
- بره از DNSهای عمومی (مثلاً گوگل) جواب بگیره
- و اون جواب رو تو حافظه نگه‌داره تا سری بعدی سریع‌تر جواب بده

**هیچ دامنه‌ای رو مدیریت نمی‌کنه**، فقط نقش واسطه و حافظه داره.

---

## 🧰 چه زمانی بهش نیاز داریم؟

- توی شبکه داخلی مثل شرکت یا دانشگاه
- برای کاهش ترافیک اینترنت
- افزایش سرعت لود صفحات
- بالا بردن امنیت (کلاینت‌ها مستقیم به DNS بیرونی وصل نمی‌شن)
- مانیتور کردن درخواست‌ها

---

## 🛠️ نصب BIND روی Ubuntu 22.04

```bash
sudo apt update
sudo apt install bind9 bind9utils bind9-doc dnsutils -y
````

---

## ⚙️ تنظیمات اصلی

فایل: `/etc/bind/named.conf.options`

تنظیماتی که باید انجام بدی:

* روشن کردن recursion
* مشخص کردن DNSهای خارجی (مثل 8.8.8.8)
* محدود کردن دسترسی فقط به شبکه داخلی (ACL)
* انتخاب پورت و IP برای گوش دادن (listen-on)

---

## 🌐 وصل کردن کلاینت‌ها به DNS داخلی

### روش 1: دستی روی هر سیستم

وارد تنظیمات شبکه شو و آدرس DNS رو بذار روی آی‌پی سرورت (مثلاً 192.168.1.100)

### روش 2: از طریق DHCP

توی تنظیمات DHCP (مودم یا روتر) مقدار DNS رو بذار روی IP سرور کشی

---

## 📊 فعال‌سازی لاگ‌گیری

### مرحله 1: اضافه کردن لاگ به `/etc/bind/named.conf`

```conf
logging {
    channel query_log {
        file "/var/log/named_query.log";
        severity info;
        print-time yes;
    };
    category queries { query_log; };
};
```

### مرحله 2: ساخت فایل لاگ و ریستارت BIND

```bash
sudo touch /var/log/named_query.log
sudo chown bind:bind /var/log/named_query.log
sudo systemctl restart bind9
```

### دیدن لاگ‌ها:

```bash
tail -f /var/log/named_query.log
```

---

## 🛡️ نکات امنیتی

* فقط شبکه داخلی اجازه درخواست داشته باشه (با ACL)
* از ابزارهایی مثل `iptables` یا `fail2ban` برای جلوگیری از حمله استفاده کن
* لاگ‌ها رو مرتب بررسی کن تا ببینی چه دامنه‌هایی بیشتر پرسیده می‌شن

---

## 🔍 تست عملکرد سرور

```bash
dig @192.168.1.100 google.com
```

اگه همه‌چی درست باشه، بار دوم خیلی سریع‌تر جواب می‌ده ✅

---

